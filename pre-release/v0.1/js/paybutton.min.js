var cssButtonId="pbButtonCSS";if(!document.getElementById(cssButtonId)){var head=document.getElementsByTagName("head")[0];(link=document.createElement("link")).rel="stylesheet",link.type="text/css",link.href="./pre-release/v0.1/css/buttons.css",link.id=cssButtonId,link.media="all",head.appendChild(link)}var cssModalId="pbModalCSS";if(!document.getElementById(cssModalId)){var link;head=document.getElementsByTagName("head")[0];(link=document.createElement("link")).rel="stylesheet",link.type="text/css",link.href="./pre-release/v0.1/css/modal.css",link.id=cssModalId,link.media="all",head.appendChild(link)}var txListen,qrId="pbQR";if(!document.getElementById(qrId)){head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.src="./pre-release/v0.1/js/qrjs2.js",script.id=qrId,head.appendChild(script)}function copyBCHURI(t){var e=document.createElement("input");e.value=t,window.payButtonParent.appendChild(e),e.select(),document.execCommand("copy",!1,null),e.remove(),document.getElementById("copyDiv").innerHTML="<span>Address Copied!</span>"}function playAudio(){var t=new Audio("./pre-release/v0.1/audio/pbding.mp3");t.volume=.02,t.play()}function getRandomSat(){return(Math.random()*(123e-8-1e-7)+1e-7).toFixed(8)}function startListenForTX(t){t.timeStamp=Math.floor(Date.now()/1e3),txListen=setInterval(function(){listenForTX(t)},1400)}function stopListenForTX(){clearInterval(txListen)}function txDialogue(t){playAudio(),t.successMsg||(t.successMsg="Transaction Successful!"),document.getElementById("modal-content").innerHTML='<div><div><div class="txdialoguediv"><div><span>'+t.successMsg+'</span></div></div><div class="txdialoguediv"><div><span>View: </span><a href="https://explorer.bitcoin.com/bch/tx/'+t.txid+'" target="_blank" style="color: orangeRed; text-decoration: none;">Transaction</a></div></div></div></div>',console.log("Confirmed. Transaction ID:",t.txid);var e=document.getElementsByClassName(t.paywallField);if(e)for(var n=0;n<e.length;n++){e[n].style.display="block"}t.successCallback&&window[t.successCallback]&&window[t.successCallback](t.txid)}function listenForTX(t){var e=new XMLHttpRequest;e.open("GET","https://rest.bitcoin.com/v2/address/unconfirmed/"+t.toAddress,!0),e.onload=function(){if(4==e.readyState&&200==e.status){console.log("listening for transaction..");for(var n=JSON.parse(e.responseText),o=0;o<n.utxos.length;o++){var a=n.utxos[o];if(t.timeStamp<a.ts&&a.amount==t.bchAmount)return stopListenForTX(),t.txid=a.txid,void txDialogue(t)}}else console.log("Found Server But There Is An Error")},e.onerror=function(){console.log("Could Not Connect To Server")},e.send()}function sendToBadger(t,e,n,o,a){if(e*=1e8,"undefined"!=typeof web4bch)if(web4bch=new Web4Bch(web4bch.currentProvider),web4bch.bch.defaultAccount){document.getElementById("badger-open").innerHTML="<span>Opening Badger Wallet</span>";var s={to:t,from:web4bch.bch.defaultAccount,value:e};web4bch.bch.sendTransaction(s,(t,e)=>{t?document.getElementById("badger-open").innerHTML="<span>Send With Badger Wallet</span>":(stopListenForTX(),txDialogue({txid:e,successMsg:n,paywallField:o,successCallback:a}))})}else document.getElementById("badger-open").innerHTML="<span>Please Unlock Badger Wallet</span>",alert("Please unlock Badger Wallet before continuing.");else document.getElementById("badger-open").innerHTML="<span>Badger Wallet Not Found</span>",window.open("https://badger.bitcoin.com"),alert("To use Badger Wallet for this transaction, Please visit:\n\nhttps://badger.bitcoin.com for installation instructions.")}function openModal(t){t.anyAmount?(t.amountMessage="Send any amount of Bitcoin Cash",t.URI=t.toAddress):(t.URI=t.toAddress+"?amount="+t.bchAmount,startListenForTX(t));var e={ecclevel:"Q",fillcolor:"#FFFFFF",textcolor:"#000000",margin:"0.5",modulesize:12};if(document.implementation.hasFeature("http://www.w3.org/2000/svg","1.1")){genQR=QRCode.generateSVG(t.URI,e);var n=new XMLSerializer;genQR=n.serializeToString(genQR),genQR="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(genQR))),qrImage=genQR}else genQR=QRCode.generatePNG(t.URI,e),qrImage=genQR;var o='<div><div><div><div class="qrparent" onclick=copyBCHURI(\''+t.URI+'\')><img class="qrcode" src="'+qrImage+'" /><img class="qricon" src="./images/spice_bare_logo.png" /><div id="copyDiv" class="qrctc">Click to Copy</div></div></div><div class="dialoguediv"><div><span>'+t.amountMessage+'</span></div> </div><div><div><button id="bch-open" class="pay-button pb-modal-button" onclick="location.href=\''+t.URI+'\'" type="button"><span>Send with BCH Wallet</span></button></div></div><div><div><button id="badger-open" class = "pay-button pb-modal-button" onclick="sendToBadger(\''+t.toAddress+"', '"+t.bchAmount+"', '"+t.successMsg+"', '"+t.paywallField+"', '"+t.successCallback+'\')" type="button"><span>Send with Badger Wallet</span></button></div> </div></div></div>';new Modal({content:o}).open()}function getBCHPrice(t){var e=new XMLHttpRequest;e.open("GET","https://api.coingecko.com/api/v3/coins/spice/",!0),e.onload=function(){if(4==e.readyState&&200==e.status){var n=JSON.parse(e.responseText);if(""!=n){t.amountType;var o=1/n.market_data.current_price.ticker*t.buttonAmount;t.satAmount=o.toFixed(8);var a=t.satAmount;t.bchAmount=a.toFixed(8),t.amountMessage=t.buttonAmount+" "+t.amountType+" = "+t.bchAmount+" BCH",openModal(t)}else console.log("Error Price Not Found")}else console.log("Found Server But There Is An Error")},e.onerror=function(){console.log("Could Not Connect To Server")},e.send()}function mouseEnter(){var t=this.getAttribute("button-text-2")||"";if(!(t=t.trim())){var e=this.getAttribute("amount")||"";e=Number(e.trim());var n=this.getAttribute("amount-type")||"";n=n.trim().toUpperCase(),t=e+" "+n,e&&n||(t="Click to send BCH")}this.innerHTML="<span>&nbsp</span>";var o=this;setTimeout(function(){o.innerHTML="<span>"+t+"</span>"},200),"ontouchend"in window||this.addEventListener("mouseleave",buttonDefaultText,!1),"ontouchend"in window&&this.addEventListener("touchend",buttonDefaultText,!1)}function buttonDefaultText(){var t=this.getAttribute("button-text")||"";if(!(t=t.trim())){var e=this.getAttribute("amount")||"";e=Number(e.trim());var n=this.getAttribute("amount-type")||"";n=n.trim().toUpperCase(),t="Send Bitcoin Cash",e&&n||(t="Send Bitcoin Cash")}this.innerHTML="<span>&nbsp</span>";var o=this;setTimeout(function(){o.innerHTML="<span>"+t+"</span>"},200)}function renderButtons(t){for(var e=document.getElementsByClassName("pay-button"),n=0;n<e.length;n++){var o=e[n];if(!1===t.onDemand&&o.classList.contains("pbtnjs"))continue;buttonDefaultText.bind(o)(),"ontouchstart"in window||o.addEventListener("mouseenter",mouseEnter,!1),"ontouchstart"in window&&o.addEventListener("touchstart",mouseEnter,!1),o.setAttribute("type","button"),o.addEventListener("click",function(t){window.payButtonParent=t.target.parentNode;var e=this.getAttribute("amount")||"";e=Number(e.trim());var n=this.getAttribute("amount-type")||"";n=n.trim().toUpperCase();var o=this.getAttribute("address")||"";o=o.trim();var a=this.getAttribute("success-msg")||"";a=a.trim();var s=this.getAttribute("paywall-field")||"";s=s.trim();var i,r=this.getAttribute("success-callback")||"",d={buttonAmount:e,amountType:n,toAddress:o,successMsg:a,paywallField:s,successCallback:r=r.trim()};if(o){if(e||n){if(!e||!n)return void alert('PayButton Error:\n\nFor specific PayButton amounts, BOTH of the following MUST be set:\n\n1. amount (Must be a number)\n2. amount-type (Can be BCH, Satoshi, USD, AUD etc)\n\nTo allow "Any" amount, BOTH must be blank.')}else d.anyAmount=!0;if(e||n||(d.anyAmount=!0,d.bchAmount=""),d.anyAmount)openModal(d);else if("BCH"==n||"SATOSHI"==n){var l=e;"SATOSHI"==n&&(l/=1e8),d.satAmount=l.toFixed(8),d.randSat=getRandomSat(),i=Number(d.satAmount)+Number(d.randSat),d.bchAmount=i.toFixed(8),d.amountMessage="Amount = "+d.bchAmount+" BCH",openModal(d)}else getBCHPrice(d)}else alert("PayButton Error:\n\nBelow are the minimum button requirements\n\n1. address (Bitcoin Cash address)")})}}!function(){this.Modal=function(){var t;this.closeButton=null,this.modal=null,this.overlay=null,this.transitionEnd=(t=document.createElement("div")).style.WebkitTransition?"webkitTransitionEnd":t.style.OTransition?"oTransitionEnd":"transitionend";arguments[0]&&"object"==typeof arguments[0]&&(this.options=function(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({autoOpen:!1,className:"fade-and-drop",content:"",maxWidth:270,minWidth:264,overlay:!0},arguments[0])),!0===this.options.autoOpen&&this.open()},Modal.prototype.close=function(){if(window.payButtonModalOpen){stopListenForTX();var t=this;this.modal.className=this.modal.className.replace(" paybutton-open",""),this.overlay.className=this.overlay.className.replace(" paybutton-open",""),this.modal.addEventListener(this.transitionEnd,function(){t.modal.parentNode.removeChild(t.modal)}),this.overlay.addEventListener(this.transitionEnd,function(){t.overlay.parentNode&&t.overlay.parentNode.removeChild(t.overlay)}),window.payButtonModalOpen=!1,delete window.payButtonParent}},Modal.prototype.open=function(){window.payButtonModalOpen||(function(){var t,e,n;t="string"==typeof this.options.content?this.options.content:this.options.content.innerHTML;n=document.createDocumentFragment(),this.modal=document.createElement("div"),this.modal.className="paybutton-modal "+this.options.className,!0===this.options.overlay&&(this.overlay=document.createElement("div"),this.overlay.className="paybutton-overlay "+this.options.className,n.appendChild(this.overlay));(e=document.createElement("div")).className="paybutton-content",e.id="modal-content",e.innerHTML=t,this.modal.appendChild(e),n.appendChild(this.modal),document.body.appendChild(n)}.call(this),function(){this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this));this.overlay&&this.overlay.addEventListener("click",this.close.bind(this));document.getElementById("bch-open").addEventListener("click",function(){this.innerHTML="<span>Opening Bitcoin Cash Wallet</span>"})}.call(this),window.getComputedStyle(this.modal).height,this.modal.className=this.modal.className+(this.modal.offsetHeight>window.innerHeight?" paybutton-open paybutton-anchored":" paybutton-open"),this.overlay.className=this.overlay.className+" paybutton-open",window.payButtonModalOpen=!0)}}(),document.addEventListener("DOMContentLoaded",function(){renderButtons({onDemand:!1})});var Paybutton={render:function(t,e){var n=document.getElementById(t),o=document.createElement("button");o.setAttribute("id",t),e.style&&o.setAttribute("style:",e.style),e.class?o.setAttribute("class","pay-button "+e.style+" pbtnjs"):o.setAttribute("class","pay-button pbtnjs"),e.button_text&&o.setAttribute("button-text",e.button_text),e.button_text_2&&o.setAttribute("button-text-2",e.button_text_2),e.success_msg&&o.setAttribute("success-msg",e.success_msg),e.address&&o.setAttribute("address",e.address),e.amount&&o.setAttribute("amount",e.amount),e.amount_type?o.setAttribute("amount-type",e.amount_type):e.amount&&o.setAttribute("amount-type","bch"),e.paywall_field&&o.setAttribute("paywall-field",e.paywall_field),e.success_callback&&o.setAttribute("success-callback",e.success_callback),n.parentNode.replaceChild(o,n),renderButtons({onDemand:!0})}};
