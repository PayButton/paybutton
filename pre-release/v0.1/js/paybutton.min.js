var cssButtonId="pbButtonCSS";if(!document.getElementById("pbButtonCSS")){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href="https://alt-win.github.io/paybutton.github.io/pre-release/v0.1/css/buttons.css",link.id=cssButtonId,link.media="all",head.appendChild(link)}var cssModalId="pbModalCSS";if(!document.getElementById("pbModalCSS")){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href="https://alt-win.github.io/paybutton.github.io/pre-release/v0.1/css/modal.css",link.id=cssModalId,link.media="all",head.appendChild(link)}var qrId="pbQR";if(!document.getElementById("pbQR")){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.src="https://alt-win.github.io/paybutton.github.io/pre-release/v0.1/js/qrjs2.js",script.id=qrId,head.appendChild(script)}(function(){function a(){var a,b,c;a="string"==typeof this.options.content?this.options.content:this.options.content.innerHTML,c=document.createDocumentFragment(),this.modal=document.createElement("div"),this.modal.className="paybutton-modal "+this.options.className,!0===this.options.overlay&&(this.overlay=document.createElement("div"),this.overlay.className="paybutton-overlay "+this.options.className,c.appendChild(this.overlay)),b=document.createElement("div"),b.className="paybutton-content",b.id="modal-content",b.innerHTML=a,this.modal.appendChild(b),c.appendChild(this.modal),document.body.appendChild(c)}function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(){this.closeButton&&this.closeButton.addEventListener("click",this.close.bind(this)),this.overlay&&this.overlay.addEventListener("click",this.close.bind(this)),document.getElementById("bch-open").addEventListener("click",function(){this.innerHTML="<span>Opening Bitcoin Cash Wallet</span>"})}function d(){var a=document.createElement("div");return a.style.WebkitTransition?"webkitTransitionEnd":a.style.OTransition?"oTransitionEnd":"transitionend"}this.Modal=function(){this.closeButton=null,this.modal=null,this.overlay=null,this.transitionEnd=d();arguments[0]&&"object"==typeof arguments[0]&&(this.options=b({autoOpen:!1,className:"fade-and-drop",content:"",maxWidth:270,minWidth:264,overlay:!0},arguments[0])),!0===this.options.autoOpen&&this.open()},Modal.prototype.close=function(){if(window.payButtonModalOpen){stopListenForTX();var a=this;this.modal.className=this.modal.className.replace(" paybutton-open",""),this.overlay.className=this.overlay.className.replace(" paybutton-open",""),this.modal.addEventListener(this.transitionEnd,function(){a.modal.parentNode.removeChild(a.modal)}),this.overlay.addEventListener(this.transitionEnd,function(){a.overlay.parentNode&&a.overlay.parentNode.removeChild(a.overlay)}),window.payButtonModalOpen=!1,delete window.payButtonParent}},Modal.prototype.open=function(){window.payButtonModalOpen||(a.call(this),c.call(this),window.getComputedStyle(this.modal).height,this.modal.className+=this.modal.offsetHeight>window.innerHeight?" paybutton-open paybutton-anchored":" paybutton-open",this.overlay.className+=" paybutton-open",window.payButtonModalOpen=!0)}})();function copyBCHURI(a){var b=document.createElement("input");b.value=a,window.payButtonParent.appendChild(b),b.select(),document.execCommand("copy",!1,null),b.remove(),document.getElementById("copyDiv").innerHTML="<span>Address Copied!</span>"}function playAudio(){var a=new Audio("https://alt-win.github.io/paybutton.github.io/pre-release/v0.1/audio/pbding.mp3");a.volume=.02,a.play()}function getRandomSat(){return(Math.random()*(123e-8-1e-7)+1e-7).toFixed(8)}var txListen;function startListenForTX(a){a.timeStamp=Math.floor(Date.now()/1e3),txListen=setInterval(function(){listenForTX(a)},1400)}function stopListenForTX(){clearInterval(txListen)}function txDialogue(a){playAudio(),a.successMsg||(a.successMsg="Transaction Successful!");var b=document.getElementById("modal-content");b.innerHTML="<div><div><div class=\"txdialoguediv\"><div><span>"+a.successMsg+"</span></div></div><div class=\"txdialoguediv\"><div><span>View: </span><a href=\"https://explorer.bitcoin.com/bch/tx/"+a.txid+"\" target=\"_blank\" style=\"color: orangeRed; text-decoration: none;\">Transaction</a></div></div></div></div>",console.log("Confirmed. Transaction ID:",a.txid);var c=document.getElementsByClassName(a.paywallField);if(c)for(var d,e=0;e<c.length;e++)d=c[e],d.style.display="block";a.successCallback&&window[a.successCallback]&&window[a.successCallback](a.txid)}function listenForTX(a){var b={v:3,q:{find:{"out.e.a":a.toAddress}}},c=new EventSource("https://bitsocket.bch.sx/s/"+btoa(JSON.stringify(b)));c.onmessage=function(b){var c=JSON.parse(b.data);if("mempool"==c.type)for(var d=0;d<c.data[0].out.length;d++)if(c.data[0].out[d].e.a==a.toAddress){var e=c.data[0].out[d].e.v/1e8,f=c.data[0].in[0].e.a,g=c.data[0].tx.h;e==a.bchAmount&&(stopListenForTX(),a.txid=g,txDialogue(a))}}}function sendToBadger(a,b,c,d,e){if(b*=1e8,"undefined"==typeof web4bch)document.getElementById("badger-open").innerHTML="<span>Badger Wallet Not Found</span>",window.open("https://badger.bitcoin.com"),alert("To use Badger Wallet for this transaction, Please visit:\n\nhttps://badger.bitcoin.com for installation instructions.");else if(web4bch=new Web4Bch(web4bch.currentProvider),!web4bch.bch.defaultAccount)document.getElementById("badger-open").innerHTML="<span>Please Unlock Badger Wallet</span>",alert("Please unlock Badger Wallet before continuing.");else{document.getElementById("badger-open").innerHTML="<span>Opening Badger Wallet</span>";var f={to:a,from:web4bch.bch.defaultAccount,value:b};web4bch.bch.sendTransaction(f,(a,b)=>{if(a)document.getElementById("badger-open").innerHTML="<span>Send With Badger Wallet</span>";else{stopListenForTX();txDialogue({txid:b,successMsg:c,paywallField:d,successCallback:e})}})}}function openModal(a){a.anyAmount?(a.amountMessage="Send any amount of Bitcoin Cash",a.URI=a.toAddress):(a.URI=a.toAddress+"?amount="+a.bchAmount,startListenForTX(a));var b={ecclevel:"Q",fillcolor:"#FFFFFF",textcolor:"#000000",margin:"0.5",modulesize:12};if(document.implementation.hasFeature("http://www.w3.org/2000/svg","1.1")){genQR=QRCode.generateSVG(a.URI,b);var c=new XMLSerializer;genQR=c.serializeToString(genQR),genQR="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(genQR))),qrImage=genQR}else genQR=QRCode.generatePNG(a.URI,b),qrImage=genQR;var d="<div><div><div><div class=\"qrparent\" onclick=copyBCHURI('"+a.URI+"')><img class=\"qrcode\" src=\""+qrImage+"\" /><img class=\"qricon\" src=\"https://alt-win.github.io/paybutton.github.io/images/bitcoincash_bare_logo.png\" /><div id=\"copyDiv\" class=\"qrctc\">Click to Copy</div></div></div><div class=\"dialoguediv\"><div><span>"+a.amountMessage+"</span></div> </div><div><div><button id=\"bch-open\" class=\"pay-button pb-modal-button\" onclick=\"location.href='"+a.URI+"'\" type=\"button\"><span>Send with BCH Wallet</span></button></div></div><div><div><button id=\"badger-open\" class = \"pay-button pb-modal-button\" onclick=\"sendToBadger('"+a.toAddress+"', '"+a.bchAmount+"', '"+a.successMsg+"', '"+a.paywallField+"', '"+a.successCallback+"')\" type=\"button\"><span>Send with Badger Wallet</span></button></div> </div></div></div>",e=new Modal({content:d});e.open()}function getBCHPrice(a){var b=new XMLHttpRequest;b.open("GET","https://index-api.bitcoin.com/api/v0/cash/price/"+a.amountType,!0),b.onload=function(){if(4==b.readyState&&200==b.status){var c=JSON.parse(b.responseText);if(""!=c.price){var d=c.price/100,e=1/d*a.buttonAmount;a.satAmount=e.toFixed(8),a.randSat=getRandomSat();var f=+a.satAmount+ +a.randSat;a.bchAmount=f.toFixed(8),a.amountMessage=a.buttonAmount+" "+a.amountType+" = "+a.bchAmount+" BCH",openModal(a)}else console.log("Error Price Not Found")}else console.log("Found Server But There Is An Error")},b.onerror=function(){console.log("Could Not Connect To Server")},b.send()}function mouseEnter(){var a=this.getAttribute("button-text-2")||"";if(a=a.trim(),!a){var b=this.getAttribute("amount")||"";b=+b.trim();var c=this.getAttribute("amount-type")||"";c=c.trim().toUpperCase(),a=b+" "+c,b&&c||(a="Click to send BCH")}this.innerHTML="<span>&nbsp</span>";var d=this;setTimeout(function(){d.innerHTML="<span>"+a+"</span>"},200),"ontouchend"in window||this.addEventListener("mouseleave",buttonDefaultText,!1),"ontouchend"in window&&this.addEventListener("touchend",buttonDefaultText,!1)}function buttonDefaultText(){var a=this.getAttribute("button-text")||"";if(a=a.trim(),!a){var b=this.getAttribute("amount")||"";b=+b.trim();var c=this.getAttribute("amount-type")||"";c=c.trim().toUpperCase(),a="Send Bitcoin Cash",b&&c||(a="Send Bitcoin Cash")}this.innerHTML="<span>&nbsp</span>";var d=this;setTimeout(function(){d.innerHTML="<span>"+a+"</span>"},200)}function renderButtons(a){for(var b,c=document.getElementsByClassName("pay-button"),d=0;d<c.length;d++){if(b=c[d],!1===a.onDemand&&b.classList.contains("pbtnjs"))continue;let e=buttonDefaultText.bind(b);e(),"ontouchstart"in window||b.addEventListener("mouseenter",mouseEnter,!1),"ontouchstart"in window&&b.addEventListener("touchstart",mouseEnter,!1),b.setAttribute("type","button"),b.addEventListener("click",function(a){window.payButtonParent=a.target.parentNode;var b=this.getAttribute("amount")||"";b=+b.trim();var c=this.getAttribute("amount-type")||"";c=c.trim().toUpperCase();var d=this.getAttribute("address")||"";d=d.trim();var e=this.getAttribute("success-msg")||"";e=e.trim();var f=this.getAttribute("paywall-field")||"";f=f.trim();var g=this.getAttribute("success-callback")||"";g=g.trim();var h,i={buttonAmount:b,amountType:c,toAddress:d,successMsg:e,paywallField:f,successCallback:g};if(!d)return void alert("PayButton Error:\n\nBelow are the minimum button requirements\n\n1. address (Bitcoin Cash address)");if(!(b||c))i.anyAmount=!0;else if(!b||!c)return void alert("PayButton Error:\n\nFor specific PayButton amounts, BOTH of the following MUST be set:\n\n1. amount (Must be a number)\n2. amount-type (Can be BCH, Satoshi, USD, AUD etc)\n\nTo allow \"Any\" amount, BOTH must be blank.");if(b||c||(i.anyAmount=!0,i.bchAmount=""),i.anyAmount)openModal(i);else if("BCH"==c||"SATOSHI"==c){var j=b;"SATOSHI"==c&&(j/=1e8),i.satAmount=j.toFixed(8),i.randSat=getRandomSat(),h=+i.satAmount+ +i.randSat,i.bchAmount=h.toFixed(8),i.amountMessage="Amount = "+i.bchAmount+" BCH",openModal(i)}else getBCHPrice(i)})}}document.addEventListener("DOMContentLoaded",function(){renderButtons({onDemand:!1})});var Paybutton={render:function(a,b){var c=document.getElementById(a),d=document.createElement("button");d.setAttribute("id",a),b.style&&d.setAttribute("style:",b.style),b.class?d.setAttribute("class","pay-button "+b.style+" pbtnjs"):d.setAttribute("class","pay-button pbtnjs"),b.button_text&&d.setAttribute("button-text",b.button_text),b.button_text_2&&d.setAttribute("button-text-2",b.button_text_2),b.success_msg&&d.setAttribute("success-msg",b.success_msg),b.address&&d.setAttribute("address",b.address),b.amount&&d.setAttribute("amount",b.amount),b.amount_type?d.setAttribute("amount-type",b.amount_type):b.amount&&d.setAttribute("amount-type","bch"),b.paywall_field&&d.setAttribute("paywall-field",b.paywall_field),b.success_callback&&d.setAttribute("success-callback",b.success_callback),c.parentNode.replaceChild(d,c),renderButtons({onDemand:!0})}};
